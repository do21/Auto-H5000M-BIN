# ======== 设备与平台定义 ========
CONFIG_MODULES=y
CONFIG_HAVE_DOT_CONFIG=y
CONFIG_HOST_OS_LINUX=y
CONFIG_TARGET_mediatek=y
CONFIG_TARGET_mediatek_filogic_DEVICE_hiveton-h5000m=y

## ======== 防火墙核心配置（暂不修复，全部注释） ========
# # 明确使用 nftables（firewall4）
# CONFIG_PACKAGE_firewall4=y
# CONFIG_PACKAGE_firewall4_USE_IPV6=y
#
# # 明确禁用 iptables 相关模块
# # CONFIG_PACKAGE_firewall is not set          # 这是旧的 firewall（iptables 后端）
# # CONFIG_PACKAGE_xtables-legacy is not set    # 禁用旧版 iptables
# # CONFIG_PACKAGE_xtables-nft is not set       # 禁用 nftables 兼容层
# # CONFIG_PACKAGE_iptables is not set          # 禁用 iptables 核心
# # CONFIG_PACKAGE_iptables-mod-conntrack-extra is not set
# # CONFIG_PACKAGE_iptables-mod-iprange is not set
# # CONFIG_PACKAGE_iptables-mod-socket is not set
# # CONFIG_PACKAGE_iptables-mod-tproxy is not set
#
# # nftables 内核模块
# CONFIG_PACKAGE_kmod-nft-core=y
# CONFIG_PACKAGE_kmod-nft-nat=y
# CONFIG_PACKAGE_kmod-nft-netdev=y
# CONFIG_PACKAGE_kmod-nft-offload=y

# ======== 内核网络配置 ========
CONFIG_PACKAGE_kmod-nf-conntrack=y
CONFIG_PACKAGE_kmod-nf-conntrack-netlink=y
CONFIG_PACKAGE_kmod-nf-conntrack6=y
CONFIG_PACKAGE_kmod-nf-flow=y
CONFIG_PACKAGE_kmod-nf-ipt=y
CONFIG_PACKAGE_kmod-nf-log=y
CONFIG_PACKAGE_kmod-nf-nat=y
CONFIG_PACKAGE_kmod-nf-reject=y
CONFIG_PACKAGE_kmod-nf-reject6=y
CONFIG_PACKAGE_kmod-nf-tproxy=y

# 特别重要的：nftables tproxy 支持
CONFIG_PACKAGE_kmod-nft-tproxy=y

# ======== QModem 核心 ========
CONFIG_PACKAGE_luci-compat=y
CONFIG_PACKAGE_qmodem=y
CONFIG_PACKAGE_luci-app-qmodem=y

# QModem 驱动选择 - 使用 Vendor 驱动
CONFIG_PACKAGE_luci-app-qmodem_INCLUDE_vendor-qmi-wwan=y
# CONFIG_PACKAGE_luci-app-qmodem_INCLUDE_generic-qmi-wwan is not set

# QModem IPv6 支持
CONFIG_PACKAGE_luci-app-qmodem_INCLUDE_ndisc6=y
# CONFIG_PACKAGE_luci-app-qmodem_INCLUDE_rdisc6 is not set
# CONFIG_PACKAGE_luci-app-qmodem_INCLUDE_no_ndisc_rdisc6 is not set
CONFIG_PACKAGE_ndisc6=y

# QModem Quectel CM 选择 - 使用 Tom 定制版
CONFIG_PACKAGE_luci-app-qmodem_USE_TOM_CUSTOMIZED_QUECTEL_CM=y
# CONFIG_PACKAGE_luci-app-qmodem_USING_QWRT_QUECTEL_CM_5G is not set
# CONFIG_PACKAGE_luci-app-qmodem_USING_NORMAL_QUECTEL_CM is not set
CONFIG_PACKAGE_quectel-CM-5G-M=y

# QModem 依赖工具
CONFIG_PACKAGE_sms-tool_q=y
CONFIG_PACKAGE_ubus-at-daemon=y
CONFIG_PACKAGE_tom_modem=y

# QModem Vendor QMI 驱动
CONFIG_PACKAGE_kmod-qmi_wwan_q=y
CONFIG_PACKAGE_kmod-qmi_wwan_f=y
CONFIG_PACKAGE_kmod-qmi_wwan_s=y

# QModem MWAN (多WAN负载均衡)
CONFIG_PACKAGE_luci-app-qmodem-mwan=y
CONFIG_PACKAGE_mwan3=y
CONFIG_PACKAGE_luci-app-mwan3=y

# ======== 常用软件 ========
CONFIG_PACKAGE_luci-app-upnp=y
CONFIG_PACKAGE_luci-app-vlmcsd=y
CONFIG_PACKAGE_vlmcsd=y
CONFIG_PACKAGE_luci-app-adguardhome=y
CONFIG_PACKAGE_adguardhome=y
CONFIG_PACKAGE_luci-app-ramfree=y
CONFIG_PACKAGE_nikki=y
CONFIG_PACKAGE_luci-app-nikki=y
CONFIG_PACKAGE_luci-i18n-nikki-zh-cn=y
CONFIG_PACKAGE_mihomo=y
CONFIG_PACKAGE_luci-app-mihomo=y
CONFIG_PACKAGE_luci-i18n-mihomo-zh-cn=y
CONFIG_PACKAGE_ca-bundle=y
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_yq=y
CONFIG_PACKAGE_kmod-tun=y

# ======== SmartDNS 完整配置 ========
CONFIG_PACKAGE_smartdns=y
CONFIG_PACKAGE_luci-app-smartdns=y
CONFIG_PACKAGE_luci-i18n-smartdns-zh-cn=y
CONFIG_PACKAGE_smartdns_compress=y
CONFIG_PACKAGE_smartdns_LE=y
# CONFIG_PACKAGE_smartdns_1 is not set

# ======== LuCI 主题 ========
CONFIG_PACKAGE_luci-theme-argon=y
CONFIG_PACKAGE_luci-app-argon-config=y

# ======== MTK 硬件加速 ========
CONFIG_PACKAGE_luci-app-turboacc-mtk=y

# ======== 风扇控制 ========
CONFIG_PACKAGE_luci-app-Airpifanctrl=y

# ======== 取消默认勾选的包 ========
# CONFIG_PACKAGE_luci-app-wrtbwmon is not set
# CONFIG_PACKAGE_luci-app-rclone is not set
# CONFIG_PACKAGE_rclone is not set
# CONFIG_PACKAGE_rclone-ng is not set
# CONFIG_PACKAGE_rclone-webui-react is not set

# ======== Modem WebUI ========
# CONFIG_PACKAGE_modem-webui is not set

# ======== 编译优化 ========
CONFIG_CCACHE=y
CONFIG_DEVEL=y
CONFIG_BUILD_LOG=y
CONFIG_KERNEL_BUILD_USER="builder"
CONFIG_KERNEL_BUILD_DOMAIN="github.actions"

# ======== 网络基础包 ========
CONFIG_PACKAGE_ip-full=y
CONFIG_PACKAGE_resolveip=y
CONFIG_PACKAGE_ipset=y
CONFIG_PACKAGE_ipset-dns=y

# ======== DNS 相关 ========
# 使用 dnsmasq-full（支持 nftables）
CONFIG_PACKAGE_dnsmasq-full=y
CONFIG_PACKAGE_dnsmasq_full_dhcp=y
CONFIG_PACKAGE_dnsmasq_full_dhcpv6=y
CONFIG_PACKAGE_dnsmasq_full_ipset=y
CONFIG_PACKAGE_dnsmasq_full_conntrack=y
CONFIG_PACKAGE_dnsmasq_full_tftp=y
# 禁用基础的 dnsmasq
# CONFIG_PACKAGE_dnsmasq is not set

# ======== 系统工具 ========
CONFIG_PACKAGE_htop=y
CONFIG_PACKAGE_nano=y
CONFIG_PACKAGE_screen=y
CONFIG_PACKAGE_tmux=y
CONFIG_PACKAGE_usbutils=y

# ======== 无线相关 ========
CONFIG_PACKAGE_wpad-openssl=y
# CONFIG_PACKAGE_wpad-basic-wolfssl is not set

# ======== 固件设置 ========
CONFIG_TARGET_ROOTFS_PARTSIZE=256
CONFIG_TARGET_ROOTFS_TARGZ=y
# CONFIG_TARGET_IMAGES_GZIP is not set

# ======== 语言包 ========
CONFIG_PACKAGE_luci-i18n-base-zh-cn=y
CONFIG_PACKAGE_luci-i18n-firewall-zh-cn=y
CONFIG_PACKAGE_luci-i18n-opkg-zh-cn=y

# ======== 内核防火墙后端选择（关键！） ========
CONFIG_KERNEL_NETFILTER=y
CONFIG_KERNEL_NETFILTER_XTABLES=n           # 禁用 iptables 内核支持
CONFIG_KERNEL_NETFILTER_NETLINK=y           # 启用 nftables 内核支持
CONFIG_KERNEL_NF_TABLES=y                   # 启用 nftables 内核模块
CONFIG_KERNEL_NF_TABLES_INET=y
CONFIG_KERNEL_NF_TABLES_NETDEV=y
CONFIG_KERNEL_NF_TABLES_IPV4=y
CONFIG_KERNEL_NF_TABLES_IPV6=y